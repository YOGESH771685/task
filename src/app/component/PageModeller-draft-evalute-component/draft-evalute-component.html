<!-- <div *ngIf="loading">Loading...</div>

<div *ngFor="let item of evaluatedData" class="card">

  <h3>{{ item.appArtifactName }} ({{ item.state }})</h3>

  <table border="1" width="100%" *ngIf="item.differences.length > 0">
    <tr>
      <th>Field</th>
      <th>Draft</th>
      <th>Actual</th>
    </tr>

    <tr *ngFor="let diff of item.differences">
      <td>{{ diff.field }}</td>
      <td style="color: green">{{ diff.draftValue |json  }}</td>
      <td style="color: red">{{ diff.actualValue | json}}</td>
    </tr>
  </table>

  <p *ngIf="item.differences.length === 0">
    No Differences
  </p>

</div> -->






































<!-- MAIN HTML -->


 <!-- <div *ngIf="loading">Loading...</div>

<div *ngIf="errorMessage" style="color:red;">
  {{ errorMessage }}
</div>

<div *ngFor="let item of evaluatedData" class="card" style="margin-bottom:20px; padding:10px; border:1px solid #ccc;">

  <h3>{{ item.appArtifactName }} ({{ item.state }})</h3>

  <table border="1" width="100%" *ngIf="item.differences.length > 0">
    <tr>
      <th>Field</th>
      <th>Draft</th>
      <th>Actual</th>
    </tr>

    <tr *ngFor="let diff of item.differences">

      <td>{{ diff.field }}</td>

      <td style="color: green; vertical-align: top;">

        <div *ngIf="isObject(diff.draftValue); else draftPrimitive">
          <div *ngFor="let entry of objectEntries(diff.draftValue)">
            <strong>{{ entry.key }}:</strong>
            {{ displayValue(entry.value) }}
          </div>
        </div>

        <ng-template #draftPrimitive>
          {{ displayValue(diff.draftValue) }}
        </ng-template>

      </td>


      <td style="color: red; vertical-align: top;">

        <div *ngIf="isObject(diff.actualValue); else actualPrimitive">
          <div *ngFor="let entry of objectEntries(diff.actualValue)">
            <strong>{{ entry.key }}:</strong>
            {{ displayValue(entry.value) }}
          </div>
        </div>

        <ng-template #actualPrimitive>
          {{ displayValue(diff.actualValue) }}
        </ng-template>

      </td>

    </tr>
  </table>

  <p *ngIf="item.differences.length === 0">
    No Differences
  </p>

</div>
 -->






<!-- <div *ngIf="loading" style="font-weight:bold; margin:10px 0;">Loading...</div>

<div *ngIf="errorMessage" style="color:red; margin:10px 0;">{{ errorMessage }}</div>

<div *ngFor="let item of evaluatedData" class="card" style="margin-bottom:20px; padding:10px; border:1px solid #ccc; border-radius:5px;">
  <h3>{{ item.appArtifactName }} ({{ item.state }})</h3>

  <table border="1" width="100%" *ngIf="item.differences.length > 0">
    <tr>
      <th>Field</th>
      <th>Draft</th>
      <th>Actual</th>
    </tr>

    <tr *ngFor="let diff of item.differences">
      <td>{{ diff.field }}</td>

      <td style="color: green; vertical-align: top;">
        <pre style="margin:0; font-family: monospace; white-space: pre-wrap; word-break: break-word; overflow: break-word; ">
  {{ formatCell(diff.draftValue) }}
        </pre>
      </td>

      <td style="color: red; vertical-align: top;">
        <pre style="margin:0; font-family: monospace; white-space: pre-wrap; word-break: break-word;">
  {{ formatCell(diff.actualValue) }}
        </pre>
      </td>
    </tr>
  </table>
  <p *ngIf="item.differences.length === 0" style="color: gray; font-style: italic;">No Differences</p>
</div> -->








<!-- new one  -->




<!-- @if (loading()) {
<div class="loading">Loading...</div>
}

@if (error()) {
<div class="error">{{ error() }}</div>
}


@for (artifact of objectKeys(groupedData()); track artifact) {

<div class="artifact-block">

  <h2 class="artifact-title">
    {{ artifact }}
  </h2>


  @for (item of groupedData()[artifact]; track $index) {

  <div class="record-card">

    <div class="record-header">
      <span class="state-label">State:</span>
      <span class="state-value">{{ item.state }}</span>
    </div>

    <table class="diff-table">

      <thead>
        <tr>
          <th>Field</th>
          <th>Draft</th>
          <th>Actual</th>
        </tr>
      </thead>

      <tbody>


        @if (item.differences.length === 0) {
        <tr>
          <td colspan="3" class="no-diff-cell">
            <div><strong>Draft ID:</strong> {{ item.draftId }}</div>
            <div class="no-diff-text">No Difference</div>
          </td>
        </tr>
        }


        @for (row of item.differences; track $index) {

        <tr>
          <td class="field-cell">
            {{ row.field }}
          </td>

          <td class="draft-cell">
            <pre>
{{ row.draft !== null && row.draft !== undefined
    ? (typeof row.draft === 'object' ? (row.draft | json) : row.draft)
    : 'null' }}
                  </pre>
          </td>

          <td class="actual-cell">
            <pre>
{{ row.actual !== null && row.actual !== undefined
    ? (typeof row.actual === 'object' ? (row.actual | json) : row.actual)
    : 'null' }}
                  </pre>
          </td>
        </tr>

        }

      </tbody>

    </table>

  </div>

  }

</div>



} -->





@if (loading()) {
<div class="loading">Loading...</div>
}
@if (error()) {
<div class="error">{{ error() }}</div>
}
@for (artifact of objectKeys(groupedData()); track artifact) {
<div class="artifact-block">
  <h2 class="artifact-title">
    {{ artifact }}
  </h2>
  <!-- Loop each record -->
  @for (item of groupedData()[artifact]; track $index) {

  <div class="record-card">

    <div class="record-header">
      <span class="state-label">State:</span>
      <span class="state-value">{{ item.state }}</span>
    </div>

    <table class="diff-table">

      <thead>
        <tr>
          <th>Field</th>
          <th>Draft</th>
          <th>Actual</th>
        </tr>
      </thead>

      <tbody>

        <!-- No Difference -->
        @if (item.differences.length === 0) {
        <tr>
          <td colspan="3" class="no-diff-cell">
            <!-- <div><strong>Draft ID:</strong> {{ item.draftId }}</div> -->
            <div class="no-diff-text">No Difference</div>
          </td>
        </tr>
        }

        <!-- Differences -->
        @for (row of item.differences; track $index) {

        <tr>
          <td class="field-cell">
            {{ row.field }}
          </td>

          <td class="draft-cell">
            <pre>
{{ row.draft !== null && row.draft !== undefined
    ? (typeof row.draft === 'object' ? (row.draft | json) : row.draft)
    : 'null' }}
            </pre>
          </td>

          <td class="actual-cell">
            <pre>
{{ row.actual !== null && row.actual !== undefined
    ? (typeof row.actual === 'object' ? (row.actual | json) : row.actual)
    : 'null' }}
            </pre>
          </td>
        </tr>
        }
      </tbody>
    </table>
  </div>
  }
</div>

}


<!-- MAPPED FIELDS SECTION  -->

@if (mappedFields().length==0){
  <h2>Mapped fields are empty</h2>
}
@else() {
<div class="mapping-section">

  <h2 class="mapping-title mapped-title">
    Mapped Fields
  </h2>

  <table class="mapping-table">

    <thead>
      <tr>
        <th>Instance Id</th>
        <th>Owner Id</th>
        <th>Event Producer Name</th>
      </tr>
    </thead>

    <tbody>

      @for (item of mappedFields(); track $index) {
      <tr>
        <td>{{ item.instanceId }}</td>
        <td>{{ item.ownerId }}</td>
        <td>{{ item.eventProducerName }}</td>
      </tr>
      }

    </tbody>

  </table>

</div>

}


<!-- UNMAPPED FIELDS SECTION -->


@if (unmappedFields().length > 0) {

<div class="mapping-section">

  <h2 class="mapping-title unmapped-title">
    Unmapped Fields
  </h2>

  <table class="mapping-table">

    <thead>
      <tr>
        <th>Instance Id</th>
        <th>Owner Id</th>
        <th>Event Producer Name</th>
      </tr>
    </thead>

    <tbody>

      @for (item of unmappedFields(); track $index) {
      <tr>
        <td>{{ item.instanceId }}</td>
        <td>{{ item.ownerId }}</td>
        <td>{{ item.eventProducerName }}</td>
      </tr>
      }

    </tbody>

  </table>

</div>

}






