<!-- <div *ngIf="loading" style="font-weight:bold; margin:10px 0;">Loading...</div>
<div *ngIf="errorMessage" style="color:red; margin:10px 0;">{{ errorMessage }}</div>

<div *ngFor="let item of evaluatedData" class="card" style="margin-bottom:20px; padding:10px; border:1px solid #ccc; border-radius:5px;">
  <h3>{{ item.appArtifactName }} ({{ item.state }})</h3>

  <table border="1" width="100%" *ngIf="item.differences.length > 0">
    <tr>
      <th>Field</th>
      <th>Draft</th>
      <th>Actual</th>
    </tr>

    <tr *ngFor="let diff of item.differences">
      <td>{{ diff.field }}</td>

      <td style="color: green; vertical-align: top;">
        <ng-container *ngIf="isObject(diff.draftValue); else draftPrimitive">
          <div *ngFor="let kv of toKeyValueArray(diff.draftValue)" style="margin-left:5px;">
            <strong>{{ kv.key }}:</strong>
            <ng-container *ngIf="isObject(kv.value) || kv.value?.length">
              <div *ngFor="let sub of kv.value" style="margin-left:15px;">
                <strong>{{ sub.key }}:</strong> {{ sub.value }}
              </div>
            </ng-container>
            <ng-container *ngIf="!kv.value?.length">{{ kv.value }}</ng-container>
          </div>
        </ng-container>
        <ng-template #draftPrimitive>{{ diff.draftValue }}</ng-template>
      </td>

      <td style="color: red; vertical-align: top;">
        <ng-container *ngIf="isObject(diff.actualValue); else actualPrimitive">
          <div *ngFor="let kv of toKeyValueArray(diff.actualValue)" style="margin-left:5px;">
            <strong>{{ kv.key }}:</strong>
            <ng-container *ngIf="isObject(kv.value) || kv.value?.length">
              <div *ngFor="let sub of kv.value" style="margin-left:15px;">
                <strong>{{ sub.key }}:</strong> {{ sub.value }}
              </div>
            </ng-container>
            <ng-container *ngIf="!kv.value?.length">{{ kv.value }}</ng-container>
          </div>
        </ng-container>
        <ng-template #actualPrimitive>{{ diff.actualValue }}</ng-template>
      </td>
    </tr>
  </table>

  <p *ngIf="item.differences.length === 0" style="color: gray; font-style: italic;">
    No Differences
  </p>
</div>
 -->

















@if (loading()) {
<div class="loading">Loading...</div>
}

@if (error()) {
<div class="error">{{ error() }}</div>
}

<!-- Loop by appArtifactName -->
@for (artifact of objectKeys(groupedData()); track artifact) {

<div class="artifact-block">

  <h2 class="artifact-title">
    {{ artifact }}
  </h2>

  <!-- Loop each record -->
  @for (item of groupedData()[artifact]; track $index) {

  <div class="record-card">

    <div class="record-header">
      <span class="state-label">State:</span>
      <span class="state-value">{{ item.state }}</span>
    </div>

    <table class="diff-table">

      <thead>
        <tr>
          <th>Field</th>
          <th>Draft</th>
          <th>Actual</th>
        </tr>
      </thead>

      <tbody>

        <!-- No Difference -->
        @if (item.differences.length === 0) {
        <tr>
          <td colspan="3" class="no-diff-cell">
            <div><strong>Draft ID:</strong> {{ item.draftId }}</div>
            <div class="no-diff-text">No Difference</div>
          </td>
        </tr>
        }

        <!-- Differences -->
        @for (row of item.differences; track $index) {

        <tr>
          <td class="field-cell">
            {{ row.field }}
          </td>

          <td class="draft-cell">
            <pre>
{{ row.draft !== null && row.draft !== undefined
    ? (typeof row.draft === 'object' ? (row.draft | json) : row.draft)
    : 'null' }}
                  </pre>
          </td>

          <td class="actual-cell">
            <pre>
{{ row.actual !== null && row.actual !== undefined
    ? (typeof row.actual === 'object' ? (row.actual | json) : row.actual)
    : 'null' }}
                  </pre>
          </td>
        </tr>

        }

      </tbody>

    </table>

  </div>

  }

</div>

}

